import{E as T,n as _,C as M,g as b,V as w,a as q,c as P,D as C,R as V,w as H,m as I,b as F,d as x,e as W,k as A}from"./index-CYG0GMNj.js";import{E as B}from"./ExternalInteractorBase-4vlObBgZ.js";class D{constructor(){this.distance=200,this.duration=.4,this.factor=100,this.speed=1,this.maxSpeed=50,this.easing=T.easeOutQuad}load(e){e&&(e.distance!==void 0&&(this.distance=e.distance),e.duration!==void 0&&(this.duration=e.duration),e.easing!==void 0&&(this.easing=e.easing),e.factor!==void 0&&(this.factor=e.factor),e.speed!==void 0&&(this.speed=e.speed),e.maxSpeed!==void 0&&(this.maxSpeed=e.maxSpeed))}}class L extends D{constructor(){super(),this.selectors=[]}load(e){super.load(e),e&&e.selectors!==void 0&&(this.selectors=e.selectors)}}class Q extends D{load(e){super.load(e),e&&(this.divs=_(e.divs,n=>{const i=new L;return i.load(n),i}))}}const h="repulse",j=0,z=6,G=3,J=2,K=0,N=0,U=1,E=.5;class X extends B{constructor(e,n){super(n),this._clickRepulse=()=>{const i=this.container,o=i.actualOptions.interactivity.modes.repulse;if(!o)return;const s=i.repulse??{particles:[]};if(s.finish||(s.count||(s.count=0),s.count++,s.count===i.particles.count&&(s.finish=!0)),s.clicking){const t=i.retina.repulseModeDistance;if(!t||t<j)return;const c=Math.pow(t/z,G),u=i.interactivity.mouse.clickPosition;if(u===void 0)return;const r=new M(u.x,u.y,c),l=i.particles.quadTree.query(r,a=>this.isEnabled(a));for(const a of l){const{dx:p,dy:f,distance:y}=b(u,a.position),d=y**J,m=o.speed,k=-c*m/d;if(d<=c){s.particles.push(a);const R=w.create(p,f);R.length=k,a.velocity.setTo(R)}}}else if(s.clicking===!1){for(const t of s.particles)t.velocity.setTo(t.initialVelocity);s.particles=[]}},this._hoverRepulse=()=>{const i=this.container,o=i.interactivity.mouse.position,s=i.retina.repulseModeDistance;!s||s<K||!o||this._processRepulse(o,s,new M(o.x,o.y,s))},this._processRepulse=(i,o,s,t)=>{const c=this.container,u=c.particles.quadTree.query(s,m=>this.isEnabled(m)),r=c.actualOptions.interactivity.modes.repulse;if(!r)return;const{easing:l,speed:a,factor:p,maxSpeed:f}=r,y=q(l),d=((t==null?void 0:t.speed)??a)*p;for(const m of u){const{dx:k,dy:R,distance:g}=b(m.position,i),O=P(y(U-g/o)*d,N,f),S=w.create(g?k/g*O:d,g?R/g*O:d);m.position.addTo(S)}},this._singleSelectorRepulse=(i,o)=>{const s=this.container,t=s.actualOptions.interactivity.modes.repulse;if(!t)return;const c=document.querySelectorAll(i);c.length&&c.forEach(u=>{const r=u,l=s.retina.pixelRatio,a={x:(r.offsetLeft+r.offsetWidth*E)*l,y:(r.offsetTop+r.offsetHeight*E)*l},p=r.offsetWidth*E*l,f=o.type===C.circle?new M(a.x,a.y,p):new V(r.offsetLeft*l,r.offsetTop*l,r.offsetWidth*l,r.offsetHeight*l),y=t.divs,d=H(y,r);this._processRepulse(a,p,f,d)})},this._engine=e,n.repulse||(n.repulse={particles:[]}),this.handleClickMode=i=>{const o=this.container.actualOptions,s=o.interactivity.modes.repulse;if(!s||i!==h)return;n.repulse||(n.repulse={particles:[]});const t=n.repulse;t.clicking=!0,t.count=0;for(const c of n.repulse.particles)this.isEnabled(c)&&c.velocity.setTo(c.initialVelocity);t.particles=[],t.finish=!1,setTimeout(()=>{n.destroyed||(t.clicking=!1)},s.duration*I)}}clear(){}init(){const e=this.container,n=e.actualOptions.interactivity.modes.repulse;n&&(e.retina.repulseModeDistance=n.distance*e.retina.pixelRatio)}interact(){const e=this.container,n=e.actualOptions,i=e.interactivity.status===F,o=n.interactivity.events,s=o.onHover,t=s.enable,c=s.mode,u=o.onClick,r=u.enable,l=u.mode,a=o.onDiv;i&&t&&x(h,c)?this._hoverRepulse():r&&x(h,l)?this._clickRepulse():W(h,a,(p,f)=>this._singleSelectorRepulse(p,f))}isEnabled(e){const n=this.container,i=n.actualOptions,o=n.interactivity.mouse,s=((e==null?void 0:e.interactivity)??i.interactivity).events,t=s.onDiv,c=s.onHover,u=s.onClick,r=A(h,t);if(!(r||c.enable&&o.position||u.enable&&o.clickPosition))return!1;const l=c.mode,a=u.mode;return x(h,l)||x(h,a)||r}loadModeOptions(e,...n){e.repulse||(e.repulse=new Q);for(const i of n)e.repulse.load(i==null?void 0:i.repulse)}reset(){}}async function $(v,e=!0){await v.addInteractor("externalRepulse",n=>Promise.resolve(new X(v,n)),e)}export{Q as Repulse,D as RepulseBase,L as RepulseDiv,$ as loadExternalRepulseInteraction};
