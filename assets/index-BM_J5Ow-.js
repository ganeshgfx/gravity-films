import{C as h,g as k,c as x,a as E,V as b,E as M,m as A,b as O,d as u}from"./index-CYG0GMNj.js";import{E as S}from"./ExternalInteractorBase-4vlObBgZ.js";const C=1,w=1,v=0;function y(a,i,t,e,c){const s=a.actualOptions.interactivity.modes.attract;if(!s)return;const n=a.particles.quadTree.query(e,c);for(const r of n){const{dx:f,dy:o,distance:d}=k(r.position,i),p=s.speed*s.factor,m=x(E(s.easing)(w-d/t)*p,C,s.maxSpeed),g=b.create(d?f/d*m:p,d?o/d*m:p);r.position.subFrom(g)}}function P(a,i){a.attract||(a.attract={particles:[]});const{attract:t}=a;if(t.finish||(t.count||(t.count=0),t.count++,t.count===a.particles.count&&(t.finish=!0)),t.clicking){const e=a.interactivity.mouse.clickPosition,c=a.retina.attractModeDistance;if(!c||c<v||!e)return;y(a,e,c,new h(e.x,e.y,c),s=>i(s))}else t.clicking===!1&&(t.particles=[])}function T(a,i){const t=a.interactivity.mouse.position,e=a.retina.attractModeDistance;!e||e<v||!t||y(a,t,e,new h(t.x,t.y,e),c=>i(c))}class D{constructor(){this.distance=200,this.duration=.4,this.easing=M.easeOutQuad,this.factor=1,this.maxSpeed=50,this.speed=1}load(i){i&&(i.distance!==void 0&&(this.distance=i.distance),i.duration!==void 0&&(this.duration=i.duration),i.easing!==void 0&&(this.easing=i.easing),i.factor!==void 0&&(this.factor=i.factor),i.maxSpeed!==void 0&&(this.maxSpeed=i.maxSpeed),i.speed!==void 0&&(this.speed=i.speed))}}const l="attract";class I extends S{constructor(i,t){super(t),this._engine=i,t.attract||(t.attract={particles:[]}),this.handleClickMode=e=>{const c=this.container.actualOptions,s=c.interactivity.modes.attract;if(!(!s||e!==l)){t.attract||(t.attract={particles:[]}),t.attract.clicking=!0,t.attract.count=0;for(const n of t.attract.particles)this.isEnabled(n)&&n.velocity.setTo(n.initialVelocity);t.attract.particles=[],t.attract.finish=!1,setTimeout(()=>{t.destroyed||(t.attract||(t.attract={particles:[]}),t.attract.clicking=!1)},s.duration*A)}}}clear(){}init(){const i=this.container,t=i.actualOptions.interactivity.modes.attract;t&&(i.retina.attractModeDistance=t.distance*i.retina.pixelRatio)}interact(){const i=this.container,t=i.actualOptions,e=i.interactivity.status===O,c=t.interactivity.events,{enable:s,mode:n}=c.onHover,{enable:r,mode:f}=c.onClick;e&&s&&u(l,n)?T(this.container,o=>this.isEnabled(o)):r&&u(l,f)&&P(this.container,o=>this.isEnabled(o))}isEnabled(i){const t=this.container,e=t.actualOptions,c=t.interactivity.mouse,s=((i==null?void 0:i.interactivity)??e.interactivity).events;if((!c.position||!s.onHover.enable)&&(!c.clickPosition||!s.onClick.enable))return!1;const n=s.onHover.mode,r=s.onClick.mode;return u(l,n)||u(l,r)}loadModeOptions(i,...t){i.attract||(i.attract=new D);for(const e of t)i.attract.load(e==null?void 0:e.attract)}reset(){}}async function q(a,i=!0){await a.addInteractor("externalAttract",t=>Promise.resolve(new I(a,t)),i)}export{D as Attract,q as loadExternalAttractInteraction};
