import{C as v,R as B,O as C,A as E,g as L,o as m,x as P,z as D,K as M,L as I,G as K,B as z}from"./index-DBuclj72.js";import{P as j}from"./ParticlesInteractorBase-CQGpfIAS.js";const _=2;class A extends v{constructor(i,n,e,t){super(i,n,e),this.canvasSize=t,this.canvasSize={...t}}contains(i){const{width:n,height:e}=this.canvasSize,{x:t,y:s}=i;return super.contains(i)||super.contains({x:t-n,y:s})||super.contains({x:t-n,y:s-e})||super.contains({x:t,y:s-e})}intersects(i){if(super.intersects(i))return!0;const n=i,e=i,t={x:i.position.x-this.canvasSize.width,y:i.position.y-this.canvasSize.height};if(e.radius!==void 0){const s=new v(t.x,t.y,e.radius*_);return super.intersects(s)}else if(n.size!==void 0){const s=new B(t.x,t.y,n.size.width*_,n.size.height*_);return super.intersects(s)}return!1}}class G{constructor(){this.blur=5,this.color=new C,this.color.value="#000",this.enable=!1}load(i){i&&(i.blur!==void 0&&(this.blur=i.blur),this.color=C.create(this.color,i.color),i.enable!==void 0&&(this.enable=i.enable))}}class N{constructor(){this.enable=!1,this.frequency=1}load(i){i&&(i.color!==void 0&&(this.color=C.create(this.color,i.color)),i.enable!==void 0&&(this.enable=i.enable),i.frequency!==void 0&&(this.frequency=i.frequency),i.opacity!==void 0&&(this.opacity=i.opacity))}}class V{constructor(){this.blink=!1,this.color=new C,this.color.value="#fff",this.consent=!1,this.distance=100,this.enable=!1,this.frequency=1,this.opacity=1,this.shadow=new G,this.triangles=new N,this.width=1,this.warp=!1}load(i){i&&(i.id!==void 0&&(this.id=i.id),i.blink!==void 0&&(this.blink=i.blink),this.color=C.create(this.color,i.color),i.consent!==void 0&&(this.consent=i.consent),i.distance!==void 0&&(this.distance=i.distance),i.enable!==void 0&&(this.enable=i.enable),i.frequency!==void 0&&(this.frequency=i.frequency),i.opacity!==void 0&&(this.opacity=i.opacity),this.shadow.load(i.shadow),this.triangles.load(i.triangles),i.width!==void 0&&(this.width=i.width),i.warp!==void 0&&(this.warp=i.warp))}}const F=2,$=1,q={x:0,y:0},H=0;function J(r,i,n,e,t){const{dx:s,dy:o,distance:c}=L(r,i);if(!t||c<=n)return c;const u={x:Math.abs(s),y:Math.abs(o)},f={x:Math.min(u.x,e.width-u.x),y:Math.min(u.y,e.height-u.y)};return Math.sqrt(f.x**F+f.y**F)}class Q extends j{constructor(i){super(i),this._setColor=n=>{if(!n.options.links)return;const e=this.linkContainer,t=n.options.links;let s=t.id===void 0?e.particles.linksColor:e.particles.linksColors.get(t.id);if(s)return;const o=t.color;s=E(o,t.blink,t.consent),t.id===void 0?e.particles.linksColor=s:e.particles.linksColors.set(t.id,s)},this.linkContainer=i}clear(){}init(){this.linkContainer.particles.linksColor=void 0,this.linkContainer.particles.linksColors=new Map}interact(i){if(!i.options.links)return;i.links=[];const n=i.getPosition(),e=this.container,t=e.canvas.size;if(n.x<q.x||n.y<q.y||n.x>t.width||n.y>t.height)return;const s=i.options.links,o=s.opacity,c=i.retina.linksDistance??H,u=s.warp;let f;u?f=new A(n.x,n.y,c,t):f=new v(n.x,n.y,c);const g=e.particles.quadTree.query(f);for(const a of g){const d=a.options.links;if(i===a||!(d!=null&&d.enable)||s.id!==d.id||a.spawning||a.destroyed||!a.links||i.links.some(k=>k.destination===a)||a.links.some(k=>k.destination===i))continue;const l=a.getPosition();if(l.x<q.x||l.y<q.y||l.x>t.width||l.y>t.height)continue;const h=J(n,l,c,t,u&&d.warp);if(h>c)continue;const w=($-h/c)*o;this._setColor(i),i.links.push({destination:a,opacity:w})}}isEnabled(i){var n;return!!((n=i.options.links)!=null&&n.enable)}loadParticlesOptions(i,...n){i.links||(i.links=new V);for(const e of n)i.links.load(e==null?void 0:e.links)}reset(){}}async function U(r,i=!0){await r.addInteractor("particlesLinks",async n=>Promise.resolve(new Q(n)),i)}function X(r,i,n,e){r.beginPath(),r.moveTo(i.x,i.y),r.lineTo(n.x,n.y),r.lineTo(e.x,e.y),r.closePath()}function Y(r){let i=!1;const{begin:n,end:e,maxDistance:t,context:s,canvasSize:o,width:c,backgroundMask:u,colorLine:f,opacity:g,links:a}=r;if(m(n,e)<=t)P(s,n,e),i=!0;else if(a.warp){let l,h;const w={x:e.x-o.width,y:e.y},k=L(n,w);if(k.distance<=t){const y=n.y-k.dy/k.dx*n.x;l={x:0,y},h={x:o.width,y}}else{const y={x:e.x,y:e.y-o.height},p=L(n,y);if(p.distance<=t){const x=-(n.y-p.dy/p.dx*n.x)/(p.dy/p.dx);l={x,y:0},h={x,y:o.height}}else{const b={x:e.x-o.width,y:e.y-o.height},x=L(n,b);if(x.distance<=t){const S=n.y-x.dy/x.dx*n.x;l={x:-S/(x.dy/x.dx),y:S},h={x:l.x+o.width,y:l.y+o.height}}}}l&&h&&(P(s,n,l),P(s,e,h),i=!0)}if(!i)return;s.lineWidth=c,u.enable&&(s.globalCompositeOperation=u.composite),s.strokeStyle=D(f,g);const{shadow:d}=a;if(d.enable){const l=M(d.color);l&&(s.shadowBlur=d.blur,s.shadowColor=D(l))}s.stroke()}function Z(r){const{context:i,pos1:n,pos2:e,pos3:t,backgroundMask:s,colorTriangle:o,opacityTriangle:c}=r;X(i,n,e,t),s.enable&&(i.globalCompositeOperation=s.composite),i.fillStyle=D(o,c),i.fill()}function ii(r){return r.sort((i,n)=>i-n),r.join("_")}function O(r,i){const n=ii(r.map(t=>t.id));let e=i.get(n);return e===void 0&&(e=I(),i.set(n,e)),e}const R=0,T=0,W=0,ni=.5,ei=1;class ti{constructor(i){this.container=i,this._drawLinkLine=(n,e)=>{const t=n.options.links;if(!(t!=null&&t.enable))return;const s=this.container,o=s.actualOptions,c=e.destination,u=n.getPosition(),f=c.getPosition();let g=e.opacity;s.canvas.draw(a=>{var y;let d;const l=(y=n.options.twinkle)==null?void 0:y.lines;if(l!=null&&l.enable){const p=l.frequency,b=M(l.color);I()<p&&b&&(d=b,g=K(l.opacity))}if(!d){const p=t.id!==void 0?s.particles.linksColors.get(t.id):s.particles.linksColor;d=z(n,c,p)}if(!d)return;const h=n.retina.linksWidth??T,w=n.retina.linksDistance??W,{backgroundMask:k}=o;Y({context:a,width:h,begin:u,end:f,maxDistance:w,canvasSize:s.canvas.size,links:t,backgroundMask:k,colorLine:d,opacity:g})})},this._drawLinkTriangle=(n,e,t)=>{const s=n.options.links;if(!(s!=null&&s.enable))return;const o=s.triangles;if(!o.enable)return;const c=this.container,u=c.actualOptions,f=e.destination,g=t.destination,a=o.opacity??(e.opacity+t.opacity)*ni;a<=R||c.canvas.draw(d=>{const l=n.getPosition(),h=f.getPosition(),w=g.getPosition(),k=n.retina.linksDistance??W;if(m(l,h)>k||m(w,h)>k||m(w,l)>k)return;let y=M(o.color);if(!y){const p=s.id!==void 0?c.particles.linksColors.get(s.id):c.particles.linksColor;y=z(n,f,p)}y&&Z({context:d,pos1:l,pos2:h,pos3:w,backgroundMask:u.backgroundMask,colorTriangle:y,opacityTriangle:a})})},this._drawTriangles=(n,e,t,s)=>{var u,f,g;const o=t.destination;if(!((u=n.links)!=null&&u.triangles.enable&&((f=o.options.links)!=null&&f.triangles.enable)))return;const c=(g=o.links)==null?void 0:g.filter(a=>{const d=this._getLinkFrequency(o,a.destination);return o.options.links&&d<=o.options.links.frequency&&s.findIndex(h=>h.destination===a.destination)>=0});if(c!=null&&c.length)for(const a of c){const d=a.destination;this._getTriangleFrequency(e,o,d)>n.links.triangles.frequency||this._drawLinkTriangle(e,t,a)}},this._getLinkFrequency=(n,e)=>O([n,e],this._freqs.links),this._getTriangleFrequency=(n,e,t)=>O([n,e,t],this._freqs.triangles),this._freqs={links:new Map,triangles:new Map}}drawParticle(i,n){const{links:e,options:t}=n;if(!(e!=null&&e.length))return;const s=e.filter(o=>t.links&&(t.links.frequency>=ei||this._getLinkFrequency(n,o.destination)<=t.links.frequency));for(const o of s)this._drawTriangles(t,n,o,s),o.opacity>R&&(n.retina.linksWidth??T)>T&&this._drawLinkLine(n,o)}async init(){this._freqs.links=new Map,this._freqs.triangles=new Map,await Promise.resolve()}particleCreated(i){if(i.links=[],!i.options.links)return;const n=this.container.retina.pixelRatio,{retina:e}=i,{distance:t,width:s}=i.options.links;e.linksDistance=t*n,e.linksWidth=s*n}particleDestroyed(i){i.links=[]}}class si{constructor(){this.id="links"}getPlugin(i){return Promise.resolve(new ti(i))}loadOptions(){}needsPlugin(){return!0}}async function oi(r,i=!0){const n=new si;await r.addPlugin(n,i)}async function ai(r,i=!0){await U(r,i),await oi(r,i)}export{V as Links,G as LinksShadow,N as LinksTriangle,ai as loadParticlesLinksInteraction};
