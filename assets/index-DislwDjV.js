import{d as x,N as u,n as g,s as D,p as h}from"./index-CO2eSMPx.js";function v(m){const{context:t,particle:e,radius:s,opacity:i}=m,n=e.emojiData,o=2,c=s*o,p=t.globalAlpha;n&&(t.globalAlpha=i,t.drawImage(n,-s,-s,c,c),t.globalAlpha=p)}const j='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"';class y{constructor(){this.validTypes=["emoji"],this._emojiShapeDict=new Map}destroy(){for(const[t,e]of this._emojiShapeDict)e instanceof ImageBitmap&&(e==null||e.close(),this._emojiShapeDict.delete(t))}draw(t){v(t)}async init(t){const e=t.actualOptions,{validTypes:s}=this;if(!s.find(o=>x(o,e.particles.shape.type)))return;const i=[u(j)],n=s.map(o=>e.particles.shape.options[o]).find(o=>!!o);n&&g(n,o=>{o.font&&i.push(u(o.font))}),await Promise.all(i)}particleDestroy(t){delete t.emojiData}particleInit(t,e){const i=e.shapeData;if(!(i!=null&&i.value))return;const n=D(i.value,e.randomIndexData),o=i.font??j;if(!n)return;const c=`${n}_${o}`,p=this._emojiShapeDict.get(c);if(p){e.emojiData=p;return}const d=h(e.size.value)*2;let f;const r=h(e.size.value);if(typeof OffscreenCanvas<"u"){const l=new OffscreenCanvas(d,d),a=l.getContext("2d");if(!a)return;a.font=`400 ${r*2}px ${o}`,a.textBaseline="middle",a.textAlign="center",a.fillText(n,r,r),f=l.transferToImageBitmap()}else{const l=document.createElement("canvas");l.width=d,l.height=d;const a=l.getContext("2d");if(!a)return;a.font=`400 ${r*2}px ${o}`,a.textBaseline="middle",a.textAlign="center",a.fillText(n,r,r),f=l}this._emojiShapeDict.set(c,f),e.emojiData=f}}async function w(m,t=!0){await m.addShape(new y,t)}export{w as loadEmojiShape};
